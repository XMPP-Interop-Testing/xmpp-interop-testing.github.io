---
layout: page
title:  "Testing in Harness"
cover-img: /assets/img/harness_splash.jpg
date:   2025-08-26 12:14:17 +0200
author: Guus der Kinderen
---

## Introduction

This guide is intended for XMPP Server developers who are building their server with Harness CI. It demonstrates how to add XMPP Interoperability and Standards Conformance tests integrated into a build & test pipeline. This assumes that you already have a pipeline established, and wish to add the additional checks.

Note that the plugin that you'll use in Harness can be shared between [Drone](/documentation/drone), [Harness](/documentation/harness), [Woodpecker](/documentation/woodpecker), and possibly other continuous integration solutions. This is why you'll see references to 'drone' in this document: that same plugin is re-used for various systems. The instructions provided herein are, however, specific to Harness.

The checks are executed within the pipeline by a plugin that we're providing. The only prerequisite is that you've got a built XMPP server and have started it (presumably as a background service)

Assuming that you have a pre-existing pipeline that build your server and starts it for integration testing, then adding our plugin is as easy as adding one step to your pipeline, like this:

{% highlight yaml %}

- step:
    type: Plugin
    name: Run XMPP Interop Framework tests against XMPP server
    identifier: Run_Drone_plugin_against_XMPP_server
    description: Executes the Drone Plugin against the XMPP server that has been created earlier in this Pipeline
    spec:
      image: ghcr.io/xmpp-interop-testing/drone-xmpp-test:latest
      settings:
        host: xmppserver
        domain: shakespeare.lit

{% endhighlight %}

This example demonstrates one possible way to provision accounts. It assumes your server is running and reachable on the host `xmppserver`, serving the XMPP domain `shakespeare.lit`, and that it supports In-Band Registration (as defined in [XEP-0077](https://xmpp.org/extensions/xep-0077.html)) to provision accounts. Other configuration methods are also available, and you can explore the full set of options in the sections below.

## A Full Example

Harness relies heavily on containerization. The following example assumes that your pipeline is set up for building an XMPP server and making available the corresponding container image, called `myorg/xmppserver`"

To execute the tests from the XMPP Integration Testing Framework, the server needs to be running. That can be achieved by running your server as a [background service](https://developer.harness.io/docs/continuous-integration/use-ci/manage-dependencies/health-check-services/), as shown in this example:

{% highlight yaml %}

- step:
    type: Background
    name: xmppserver
    identifier: xmppserver
    spec:
      connectorRef: MyOrg_Container_Registry
      image: myorg/xmppserver:latest
      shell: Sh
      entrypoint:
        - /sbin/entrypoint.sh
        - "-MyCustomStartupArgument 1234"
  contextType: Pipeline

{% endhighlight %}

The host on which your XMPP service is running will match the `identifier` value of the step.

Optionally, include a Run step that checks the health of your xmppserver service.

Next, you're ready to add a step that runs the XMPP Interop Framework Testing plugin.

{% highlight yaml %}

- step:
    type: Plugin
    name: Run XMPP Interop Framework tests against XMPP server
    identifier: Run_Tests_against_XMPP_server
    description: Executes the Drone Plugin against the XMPP server that has been created earlier in this Pipeline
    spec:
      image: ghcr.io/xmpp-interop-testing/drone-xmpp-test:latest
      reports:
        type: JUnit
        spec:
          paths:
            - "**/*.xml"
      settings:
        host: xmppserver
        domain: shakespeare.lit
        adminAccountUsername: juliet
        adminAccountPassword: O_Romeo_Romeo
        enabledSpecifications: XEP-0115,XEP-0199,XEP-0352

{% endhighlight %}

The above assumes that your server is running and reachable on the host `xmppserver`, serving the XMPP domain `shakespeare.lit` and that it is provisioned with an administrative account (one that is allowed to create other users, per [XEP-0133](https://xmpp.org/extensions/xep-0133.html)) that uses the username `juliet` and the provided password. You'll find the full range of available configuration options below.

Furthermore, the "JUnit" configuration makes available the test results in the Harness user interface, under the 'Tests' tab of each build result.

Harness does not make available the XMPP stanza logs that are generated by the XMPP Interop Framework plugin. To have access to these logs, which are very helpful to [diagnose test failures](/documentation/diagnose-test-failures), the logs can [be uploaded as an artifact](https://developer.harness.io/docs/category/uploaddownload-artifacts) to a storage provider of your choice.

## Configuration

Various options are available when calling _xmpp-interop-testing/drone-xmpp-test_, and whilst none of them are absolutely required, the defaults are unlikely to be perfect for everyone.

For the latest updates to the documentation of the configuration updates, consult the [GitHub repository of the Drone plugin](https://github.com/XMPP-Interop-Testing/xmpp-interop-tests-drone-plugin).

{% include doc-conf-table.html %}

{% include doc-conf-provision.html %}

{% include doc-next-steps.html %}

_Splash image courtesy of [Harness](https://developer.harness.io/img/ci.svg)_
